{"name": "Modernize NPC Tokens", "type": "script", "author": "kP09MjF5zDygPc2j", "img": "modules/game-icons-net/whitetransparent/gun-rose.svg", "scope": "global", "command": "let modernWeapons = {\n\t\"Pistol\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/colt-m1911.svg\",\n\t\t\"properties\": [\"lgt\"],\n\t\t\"range\": {\"value\": 40, \"long\": 160, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d4\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Sawed-off Shotgun\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/sawed-off-shotgun.svg\",\n\t\t\"properties\": [\"scatter\", \"two\"],\n\t\t\"range\": {\"value\": 30, \"long\": 90, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"3d4\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Double-barreled Shotgun\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/sawed-off-shotgun.svg\",\n\t\t\"properties\": [\"scatter\", \"two\"],\n\t\t\"range\": {\"value\": 60, \"long\": 180, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"4d4\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Hunting Rifle\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/winchester-rifle.svg\",\n\t\t\"properties\": [\"scoped\", \"two\"],\n\t\t\"range\": {\"value\": 150, \"long\": 600, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"3d4\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Submachine Gun\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/spectre-m4.svg\",\n\t\t\"properties\": [\"burstfire\", \"two\"],\n\t\t\"range\": {\"value\": 50, \"long\": 200, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Revolver\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/revolver.svg\",\n\t\t\"range\": {\"value\": 40, \"long\": 160, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Magnum\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/revolver_1.svg\",\n\t\t\"range\": {\"value\": 40, \"long\": 160, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d8\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Combat Shotgun\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/lee-enfield.svg\",\n\t\t\"properties\": [\"automatic\", \"scatter\", \"two\"],\n\t\t\"range\": {\"value\": 60, \"long\": 180, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"5d4\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Assault Rifle\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/mp5.svg\",\n\t\t\"properties\": [\"two\", \"automatic\", \"burstfire\"],\n\t\t\"range\": {\"value\": 100, \"long\": 400, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Sniper Rifle\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/steyr-aug.svg\",\n\t\t\"properties\": [\"two\", \"scoped\"],\n\t\t\"range\": {\"value\": 200, \"long\": 800, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d8\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Micro SMG\": {\n\t\t\"img\": \"modules/game-icons-net/blackbackground/uzi.svg\",\n\t\t\"properties\": [\"lgt\", \"automatic\"],\n\t\t\"range\": {\"value\": 200, \"long\": 800, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d8\", \"piercing\"]], \"versatile\": \"\"}\n\t}\n};\n\n\nlet replacements = {\n\t\"shortbow\": [{\"min-dex\": 0, \"replace\": \"Pistol\"}, {\"min-dex\": 3, \"replace\": \"Sawed-off Shotgun\"}, {\"min-dex\": 5, \"replace\": \"Double-barreled Shotgun\"}],\n\t\"light_crossbow\": [{\"min-dex\": 0, \"replace\": \"Hunting Rifle\"}, {\"min-dex\": 4, \"replace\": \"Submachine Gun\"}],\n\t\"sling\": [{\"min-dex\": 0, \"replace\": \"Pistol\"}, {\"min-dex\": 3, \"replace\": \"Revolver\"}],\n\t\"heavy_crossbow\": [{\"min-dex\": 0, \"replace\": \"Magnum\"}, {\"min-dex\": 4, \"replace\": \"Combat Shotgun\"}],\n\t\"longbow\": [{\"min-dex\": 0, \"replace\": \"Assault Rifle\"}, {\"min-dex\": 4, \"replace\": \"Sniper Rifle\"}],\n\t\"hand_crossbow\": [{\"min-dex\": 0, \"replace\": \"Micro SMG\"}]\n};\n\nfunction generateHtmlAtkDescription(weapon, actorData) {\n\ttoHit = actorData.abilities.dex.mod + actorData.prof\n\tdist = weapon.range.value\n\tlong = weapon.range.long\n\tunit = weapon.range.units\n\tdmg = weapon.damage.parts[0][0]\n\tdmgType = weapon.damage.parts[0][1]\n\n\tif (weapon.properties) {\n\t\tpropertyList = weapon.properties.map(p => CONFIG.DND5E.weaponProperties[p])\n\t\tif (propertyList === 0) {\n\t\t\tproperties = ''\n\t\t} else if (propertyList.length === 1) {\n\t\t\tproperties = `This weapon has the ${propertyList[0]} property.`\n\t\t} else if (propertyList.length === 2) {\n\t\t\tproperties = `This weapon has the ${propertyList[0]} and ${propertyList[1]} properties.`\n\t\t} else {\n\t\t\tproperties = `This weapon has the ${propertyList.slice(0,-1).join(', ')}, and ${propertyList[propertyList.length-1]} properties.`\n\t\t}\n\t\tproperties = ''\n\t} else {\n\t\tproperties = ''\n\t}\n\n\treturn `\n\t<p><em> <strong></strong> Ranged Weapon Attack:</em> +${toHit} to hit, range ${dist}/${long} ${unit}, one target. <em>Hit:</em> ${dmg} ${dmgType} damage. ${properties}</p>\n\t`\n}\n\nfunction replaceWeapon(actor, weapon) {\n\titem_slug = weapon.data.name.toLowerCase().replace(' ', '_')\n\tif (replacements[item_slug]) {\n\t\tdex = actor.data.data.abilities.dex.mod\n\t\treplacement = null\n\t\tcurrentMin = -1\n\t\tfor (const replace of replacements[item_slug]) {\n\t\t\tif (dex >= replace[\"min-dex\"] && replace[\"min-dex\"] > currentMin) {\n\t\t\t\treplacement = replace['replace'];\n\t\t\t\tcurrentMin = replace['min-dex'];\n\t\t\t}\n\t\t}\n\t\tif (replacement) {\n\t\t\tlet replacementItem = modernWeapons[replacement];\n\t\t\tlet updated = {\n\t\t\t\t\"name\": replacement,\n\t\t\t\t\"img\": replacementItem.img,\n\t\t\t\t\"data.description.value\": generateHtmlAtkDescription(replacementItem, actor.data.data),\n\t\t\t\t\"data.range\": replacementItem.range,\n\t\t\t\t\"data.damage\": replacementItem.damage\n\t\t\t}\n\t\t\tif (replacementItem.properties) {\n\t\t\t\tlet props = weapon.data.data.properties;\n\t\t\t\treplacementItem.properties.forEach(p => props[p] = true)\n\t\t\t\tupdated[\"data.properties\"] = props\n\t\t\t}\n\t\t\tweapon.update(updated)\n\t\t}\n\t}\n}\n\nlet tokensToModernize = canvas.tokens.controlled.filter(t => t.actor.data.type === \"npc\");\n\ntokensToModernize.forEach(token => {\n\t// Get token items\n\tlet tokenWeapons = token.actor.items.filter(i => i.type === \"weapon\");\n\ttokenWeapons.forEach(w => replaceWeapon(token.actor, w))\n})", "folder": null, "sort": 0, "_id": "RRXwsPpX1rIRwTP4", "permission": {"default": 0, "kP09MjF5zDygPc2j": 3}, "flags": {}}
