{"name": "Modernize NPCs", "type": "script", "scope": "global", "author": "35XmDJHnBMPCEkei", "img": "modules/game-icons-net/whitetransparent/gun-rose.svg", "command": "let modernWeapons = {\n\t\"Handgun\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20Pistol/icon_gun_pi4fn57c-resources.assets-2403.png\",\n\t\t\"properties\": [\"lgt\"],\n\t\t\"range\": {\"value\": 40, \"long\": 120, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d4\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Sawed-off Shotgun\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20Shotgun/icon_gun_streetsweeper-resources.assets-1375.png\",\n\t\t\"properties\": [\"scatter\", \"foregrip\"],\n\t\t\"range\": {\"value\": 20, \"long\": 60, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"2d8\"}\n\t},\n\t\"Double-barreled Shotgun\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20Shotgun/icon_gun_remington990-resources.assets-306.png\",\n\t\t\"properties\": [\"scatter\", \"two\", \"strreq\"],\n\t\t\"range\": {\"value\": 40, \"long\": 120, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"2d8\"}\n\t},\n\t\"Hunting Rifle\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20Shotgun/icon_gun_defiancet250-resources.assets-2049.png\",\n\t\t\"properties\": [\"scoped\", \"two\"],\n\t\t\"range\": {\"value\": 80, \"long\": 240, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Submachine Gun\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20SMG/icon_SMG_SandlerTMP_Gobbet-resources.assets-685.png\",\n\t\t\"properties\": [\"burstfire\", \"two\"],\n\t\t\"range\": {\"value\": 40, \"long\": 120, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Revolver\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20Pistol/icon_gun_rugersuperwarhawk-resources.assets-730.png\",\n\t\t\"range\": {\"value\": 40, \"long\": 120, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Magnum\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20Pistol/icon_gun_arespredator-resources.assets-2021.png\",\n\t\t\"range\": {\"value\": 60, \"long\": 180, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d8\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Pump Shotgun\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20Shotgun/icon_gun_benelliraffaello-resources.assets-714.png\",\n\t\t\"properties\": [\"scatter\", \"two\"],\n\t\t\"range\": {\"value\": 80, \"long\": 240, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"2d8\"}\n\t},\n\t\"Assault Rifle\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20AR/icon_gun_ak98-resources.assets-1283.png\",\n\t\t\"properties\": [\"two\", \"automatic\"],\n\t\t\"range\": {\"value\": 80, \"long\": 240, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d6\", \"piercing\"]], \"versatile\": \"\"}\n\t},\n\t\"Sniper Rifle\": {\n\t\t\"img\": \"modules/cyberpunk-5e/assets/weapon_icons/Weapons%20Ranged%20Sniper/icon_gun_ruger100-resources.assets-2576.png\",\n\t\t\"properties\": [\"two\", \"sighted\"],\n\t\t\"range\": {\"value\": 200, \"long\": 800, \"units\": \"ft\"},\n\t\t\"damage\": {\"parts\": [[\"2d8\", \"piercing\"]], \"versatile\": \"\"}\n\t}\n};\n\n\nlet weaponReplacements = {\n\t\"shortbow\": [{\"min-dex\": 0, \"replace\": \"Handgun\"}, {\"min-dex\": 3, \"replace\": \"Sawed-off Shotgun\"}, {\"min-dex\": 5, \"replace\": \"Double-barreled Shotgun\"}],\n\t\"light_crossbow\": [{\"min-dex\": 0, \"replace\": \"Hunting Rifle\"}, {\"min-dex\": 4, \"replace\": \"Submachine Gun\"}],\n\t\"sling\": [{\"min-dex\": 0, \"replace\": \"Pistol\"}, {\"min-dex\": 3, \"replace\": \"Revolver\"}],\n\t\"heavy_crossbow\": [{\"min-dex\": 0, \"replace\": \"Magnum\"}, {\"min-dex\": 4, \"replace\": \"Pump Shotgun\"}],\n\t\"longbow\": [{\"min-dex\": 0, \"replace\": \"Assault Rifle\"}, {\"min-dex\": 4, \"replace\": \"Sniper Rifle\"}],\n\t\"hand_crossbow\": [{\"min-dex\": 0, \"replace\": \"Magnum\"}]\n};\n\nlet equipmentReplacements = {\n\t\"padded\": {\"name\": \"Synthleather\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_classlessstarter-resources.assets-2818.png\", \"description\": \"This jacket is made of a strong, durable fabric that imitates the feel of real leather. While it may not be able to stop a bullet or knife directly, it does protect the wearer from grazes and indirect hits.\"},\n\t\"leather\": {\"name\": \"Synthleather\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_classlessstarter-resources.assets-2818.png\", \"description\": \"This jacket is made of a strong, durable fabric that imitates the feel of real leather. While it may not be able to stop a bullet or knife directly, it does protect the wearer from grazes and indirect hits.\"},\n\t\"studdedleather\": {\"name\": \"Combat Suit\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_backer_krell_akumalshibara-resources.assets-1299.png\", \"description\": \"This form-fitting armor covers the body in thin, flexible material that holds up decently against small arms fire, but provides little protection against blunt force trauma. It fits snugly enough that other clothes can be worn over it, making it difficult to detect.\"},\n\t\"hide\": {\"name\": \"Street Armor\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_backer_nagel_bryanlitelightner-resources.assets-1185.png\", \"description\": \"A motley mix of scavenged junk parts riveted together into a crude form of armor. Each set of street armor is unique. The usual suspects include bent hubcaps, stitched tire rubber, molded sheet plastic, and fashionable spikes and bolts.\"},\n\t\"chainshirt\": {\"name\": \"Combat Vest\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_magetraditional-resources.assets-2074.png\", \"description\": \"Heavy ballistic fabric is meshed together into many layers that form a soft, but durable vest that protects the torso and precious organs.\"},\n\t\"scalemail\": {\"name\": \"Armored Jacket\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_samuraistarter-resources.assets-977.png\", \"description\": \"This long jacket is composed entirely of dense layers of ballistic material. Strategic areas around the body are additionally protected by strong metallic plate inserts.\"},\n\t\"breastplate\": {\"name\": \"Plated Vest\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/Icon_outfit_samuraibunny_maskless-resources.assets-1896.png\", \"description\": \"A combat vest with much of its fabric layers replaced with stab-proof ballistic metal plates that form a solid barrier.\"},\n\t\"halfplate\": {\"name\": \"Armored Trenchcoat\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_samuraibrowncoat-resources.assets-2545.png\", \"description\": \"Similar to the armored jacket, but this trench coat falls well below the knees and has a long collar to protect the neck.\"},\n\t\"ringmail\": {\"name\": \"Security Armor\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_disguise_lonestar-resources.assets-1177.png\", \"description\": \"Thick pads of ballistic fabric cover the body from neck to foot while metal plate inserts protect the torso, neck, and shoulders. This armor is easily mass-produced, making it the body armor of choice for outfitting security guards and cops.\"},\n\t\"chainmail\": {\"name\": \"Shock Armor\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_samuraimilitary-resources.assets-2689.png\", \"description\": \"Designed for riot police when they need to put down violent, armed uprisings, this armor has exposed metal plates that, in addition to covering the torso, also protect the arms and legs of the wearer. Often paired with a helmet with a tempered glass or slotted metal face plate.\"},\n\t\"splint\": {\"name\": \"Heavy Tactical Suit\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_samuraishades-resources.assets-1392.png\", \"description\": \"This sleek military-style heavy armor has thick ballistic plates over critical areas and joints, and thinner, ceramic plates woven together with ballistic fabric to cover the limbs. A thick helmet covers the head with plasteel goggles inset to allow for vision.\"},\n\t\"plate\": {\"name\": \"Battle Armor\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/icon_outfit_disguise_knighterrant-resources.assets-1012.png\", \"description\": \"Bearers of this full suit of heavy-duty ballistic shielding look like a walking tank. The thick helmet,metal coated boots, and overlapping alloy plates ensure the wearer is protected from attacks from any angle. The suit's joints use heavy rubber gaskets, and its interior is padded to avoid chafing.\"},\n\t\"shield\": {\"name\": \"Ballistic Shield\", \"img\": \"modules/cyberpunk-5e/assets/armor_icons/ballistic-shield-icon.png\", \"description\": \"This handheld shield is made from plasteel or metallic plating. Typically used in riot policing and SWAT raids, the shield remains relevant in the modern battlefield.\"}\n}\n\nfunction generateHtmlAtkDescription(weapon, actorData) {\n\ttoHit = actorData.abilities.dex.mod + actorData.attributes.prof\n\tdist = weapon.range.value\n\tlong = weapon.range.long\n\tunit = weapon.range.units\n\tdmg = weapon.damage.parts[0][0]\n\tdmgType = weapon.damage.parts[0][1]\n\n\tif (weapon.properties) {\n\t\tpropertyList = weapon.properties.map(p => CONFIG.DND5E.weaponProperties[p])\n\t\tif (propertyList === 0) {\n\t\t\tproperties = ''\n\t\t} else if (propertyList.length === 1) {\n\t\t\tproperties = `This weapon has the ${propertyList[0]} property.`\n\t\t} else if (propertyList.length === 2) {\n\t\t\tproperties = `This weapon has the ${propertyList[0]} and ${propertyList[1]} properties.`\n\t\t} else {\n\t\t\tproperties = `This weapon has the ${propertyList.slice(0,-1).join(', ')}, and ${propertyList[propertyList.length-1]} properties.`\n\t\t}\n\t} else {\n\t\tproperties = ''\n\t}\n\n\treturn `\n\t<p><em> <strong></strong> Ranged Weapon Attack:</em> +${toHit} to hit, range ${dist}/${long} ${unit}, one target. <em>Hit:</em> ${dmg} ${dmgType} damage. ${properties}</p>\n\t`\n}\n\nfunction replaceWeapon(actor, weapon) {\n\titem_slug = weapon.name.toLowerCase().replace(' ', '_')\n\tif (weaponReplacements[item_slug]) {\n\t\tdex = actor.system.abilities.dex.mod\n\t\treplacement = null\n\t\tcurrentMin = -1\n\t\tfor (const replace of weaponReplacements[item_slug]) {\n\t\t\tif (dex >= replace[\"min-dex\"] && replace[\"min-dex\"] > currentMin) {\n\t\t\t\treplacement = replace['replace'];\n\t\t\t\tcurrentMin = replace['min-dex'];\n\t\t\t}\n\t\t}\n\t\tif (replacement) {\n\t\t\tlet replacementItem = modernWeapons[replacement];\n\t\t\tlet updated = {\n\t\t\t\t\"name\": replacement,\n\t\t\t\t\"img\": replacementItem.img,\n\t\t\t\t\"system.description.value\": generateHtmlAtkDescription(replacementItem, actor.system),\n\t\t\t\t\"system.range\": replacementItem.range,\n\t\t\t\t\"system.damage\": replacementItem.damage\n\t\t\t}\n\t\t\tif (replacementItem.properties) {\n\t\t\t\tlet props = weapon.data.data.properties;\n\t\t\t\treplacementItem.properties.forEach(p => props[p] = true)\n\t\t\t\tupdated[\"system.properties\"] = props\n\t\t\t}\n\t\t\tweapon.update(updated)\n\t\t}\n\t}\n}\n\nfunction replaceEquipment(actor, equipment) {\n\titem_slug = equipment.name.toLowerCase().replace('armor','').replace(' ', '').replace('-', '')\n\tlet replacementItem = equipmentReplacements[item_slug]\n\tif (replacementItem) {\n\t\tlet updated = {\n\t\t\t\"name\": replacementItem.name,\n\t\t\t\"img\": replacementItem.img,\n\t\t\t\"system.description.value\": '<p>' + replacementItem.description + '</p>'\n\t\t}\n\t\tequipment.update(updated)\n\t}\n}\n\nlet tokensToModernize = canvas.tokens.controlled.filter(t => t.actor.type === \"npc\");\n\ntokensToModernize.forEach(token => {\n\t// Get token items\n\tlet tokenWeapons = token.actor.items.filter(i => i.type === \"weapon\");\n\ttokenWeapons.forEach(w => replaceWeapon(token.actor, w))\n\tlet tokenEquipment = token.actor.items.filter(i => i.type == \"equipment\")\n\ttokenEquipment.forEach(e => replaceEquipment(token.actor, e))\n})", "folder": "nGAiBuDMmniXthgK", "sort": 100000, "_id": "0VseDBXuNXsltyvc", "flags": {}, "_stats": {"systemId": "dnd5e", "systemVersion": "2.0.3", "coreVersion": "10.287", "createdTime": 1665282687713, "modifiedTime": 1665301623490, "lastModifiedBy": "35XmDJHnBMPCEkei"}, "ownership": {"default": 0, "35XmDJHnBMPCEkei": 3}}
