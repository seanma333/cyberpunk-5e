{"name":"Reload","type":"chat","author":"kP09MjF5zDygPc2j","img":"icons/svg/dice-target.svg","scope":"global","command":"targetConsumableId = item.data.data.consume.target\ntargetToConsume = Math.max(item.data.data.consume.amount - item.data.data.quantity, 0)\n\nrefillItem = token.actor.items.get(targetConsumableId)\nif (refillItem) {\n  qty = refillItem.data.data.quantity\n  if (qty >= targetToConsume) {\n    console.log(\"Reloading!\")\n    await refillItem.update({\"data.quantity\": qty - targetToConsume})\n    await item.update({\"data.quantity\": item.data.data.consume.amount})\n  } else {\n    await refillItem.update({\"data.quantity\": 0})\n    await item.update({\"data.quantity\": item.data.data.quantity + qty})\n  }\n} else {\n  console.log(\"no consumable target!\")\n}","folder":null,"sort":0,"permission":{"default":0,"kP09MjF5zDygPc2j":3},"flags":{"core":{"sourceId":"Macro.YfskcVC1DNDrpD0O"}},"_id":"U32FDbfNBrKYjjRI"}
{"_id":"U32FDbfNBrKYjjRI","name":"Reload","type":"script","author":"kP09MjF5zDygPc2j","img":"icons/svg/dice-target.svg","scope":"global","command":"targetConsumableId = item.data.data.consume.target\ntargetToConsume = Math.max(item.data.data.consume.amount - item.data.data.quantity, 0)\n\nrefillItem = token.actor.items.get(targetConsumableId)\nif (refillItem) {\n  qty = refillItem.data.data.quantity\n  if (qty >= targetToConsume) {\n    console.log(\"Reloading!\")\n    await refillItem.update({\"data.quantity\": qty - targetToConsume})\n    await item.update({\"data.quantity\": item.data.data.consume.amount})\n  } else {\n    await refillItem.update({\"data.quantity\": 0})\n    await item.update({\"data.quantity\": item.data.data.quantity + qty})\n  }\n} else {\n  console.log(\"no consumable target!\")\n}","folder":null,"sort":0,"permission":{"default":0,"kP09MjF5zDygPc2j":3},"flags":{"core":{"sourceId":"Macro.YfskcVC1DNDrpD0O"}}}
{"$$deleted":true,"_id":"U32FDbfNBrKYjjRI"}
{"name":"Reload","type":"script","author":"kP09MjF5zDygPc2j","img":"icons/svg/dice-target.svg","scope":"global","command":"targetConsumableId = item.data.data.consume.target\ntargetToConsume = Math.max(item.data.data.consume.amount - item.data.data.quantity, 0)\n\nrefillItem = token.actor.items.get(targetConsumableId)\nif (refillItem) {\n  qty = refillItem.data.data.quantity\n  if (qty >= targetToConsume) {\n    console.log(\"Reloading!\")\n    await refillItem.update({\"data.quantity\": qty - targetToConsume})\n    await item.update({\"data.quantity\": item.data.data.consume.amount})\n  } else {\n    await refillItem.update({\"data.quantity\": 0})\n    await item.update({\"data.quantity\": item.data.data.quantity + qty})\n  }\n} else {\n  console.log(\"no consumable target!\")\n}","folder":null,"sort":0,"permission":{"default":0,"kP09MjF5zDygPc2j":3},"flags":{"core":{"sourceId":"Macro.YfskcVC1DNDrpD0O"}},"_id":"GNxeTQuu0sHGhPjb"}
