{"_id": "S1Jki1VcSoYfubCT", "name": "Tool Check", "type": "script", "author": "kP09MjF5zDygPc2j", "img": "modules/game-icons-net/whitetransparent/tinker.svg", "scope": "global", "command": "const wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay));\n\nasync function getToolNames(game, toolIds) {\n  let pack = game.packs.get(CONFIG.DND5E.sourcePacks.ITEMS);\n  console.log(pack)\n  for (const [key, id] of Object.entries(toolIds)) {\n    let itemId = CONFIG.DND5E.toolIds[id];\n    console.log(itemId)\n  }\n  return []\n}\n\nasync function rollToolCheck(actor, tool, mod, expertise) {\n  let actorData = actor.data.data\n  console.log(actorData)\n  console.log(tool)\n\n  let proficiency = expertise ? actorData.prof * 2 : actorData.prof;\n  console.log(proficiency)\n\n  let roll = new Roll('1d20+'+proficiency+'+'+mod).roll();\n  console.log(roll);\n  let contentHtml = `<header class=\"card-header flexrow\"><h3>${tool}${expertise ? ' (expertise)' : ''}</h3></header>\n    <div class=\"card-buttons\">\n      <div class=\"flexrow 1\">\n        <div class=\"dice-roll\">\n          <div class=\"dice-result\">\n            <div class=\"dice-formula\">${roll.formula}</div>\n            <h4 class=\"dice-total\">${roll.total}</div>\n          </div>\n        </div>\n      </div>\n    </div>`\n\n  ChatMessage.create({\n    user: game.user._id,\n    speaker: ChatMessage.getSpeaker({token: actor}),\n    content: contentHtml\n  })\n}\n\n\nvar toolProf = token.actor.data.data.traits.toolProf;\nlet tools = await getToolNames(game, toolProf.value);\n\nconsole.log(toolProf.custom)\nif (toolProf.custom) {\n  tools = tools.concat(toolProf.custom.split(';'));\n}\n\nlet abilityScoreSelector = `\n<div><label>Select ability score:</label></div>\n<div>\n  <select id=\"ability\" name=\"ability\">\n    <option value=\"str\">Strength</option>\n    <option value=\"dex\">Dexterity</option>\n    <option value=\"con\">Constitution</option>\n    <option value=\"int\" select>Intelligence</option>\n    <option value=\"wis\">Wisdom</option>\n    <option value=\"cha\">Charisma</option>\n  </select>\n</div>\n`\n\nlet expertiseSelector = `\n<div><label>Expertise?</label><input name=\"expertise\" type=\"checkbox\"/></div>\n`\n\nlet dialogHtml = abilityScoreSelector.concat(expertiseSelector)\n\ntoolButtons = {};\ntools.forEach(tool => {\n  toolButtons[tool] = {\n    label: tool,\n    callback: (html) => {\n      let selected = html.find(\"[id=ability]\")[0].value;\n      let expertise = html.find(\"[name=expertise]\")[0].checked;\n      let mod = token.actor.data.data.abilities[selected].mod;\n      rollToolCheck(token.actor, tool, mod, expertise)\n    }\n  }\n})\n\nlet d = new Dialog({\n  title: \"Tool Check\",\n  content: dialogHtml,\n  buttons: toolButtons\n})\nd.render(true)", "folder": null, "sort": 0, "permission": {"default": 0, "kP09MjF5zDygPc2j": 3}, "flags": {}}
